<script lang="ts">
	import { createEventDispatcher } from 'svelte';
	import { tick, getContext } from 'svelte';

	const i18n = getContext('i18n');

	const dispatch = createEventDispatcher();

	export let prompt = '';

	let selectedIdx = 0;
	let selectUrlUserPrompt = [
		$i18n.t("Summarize web content"),
		$i18n.t("Tell me what the web page is about"),
		$i18n.t("Write an original article referring to the web page")
	];

	$: if (prompt) {
		selectedIdx = 0;
	}

	export const selectUp = () => {
		selectedIdx = Math.max(0, selectedIdx - 1);
	};

	export const selectDown = () => {
		selectedIdx = Math.min(selectedIdx + 1, selectUrlUserPrompt.length - 1);
	};

	const confirmSelect = async (userPrompt:string) => {
		dispatch('select', userPrompt);
	};

	const isValidUrl = (text: string) => {
    try {
      new URL(text);
      return true;
    } catch (error) {
      return false;
    }
  };

	
</script>

{#if (prompt.startsWith("http://") || prompt.startsWith("https://")) && isValidUrl(prompt)}
	<div class="md:px-2 mb-3 text-left w-full absolute bottom-0 left-0 right-0">
		<div class="flex w-full px-2">
			<div class=" bg-gray-100 dark:bg-gray-700 w-10 rounded-l-xl text-center">
				<div class="flex just justify-center mt-4">
					<svg 
						viewBox="0 0 1024 1024" 
						version="1.1" 
						xmlns="http://www.w3.org/2000/svg"
						fill="currentColor"
						class="w-5 h-5" >
						<path d="M837.818182 190.836364c-83.781818-88.436364-200.145455-139.636364-325.818182-139.636364-121.018182-4.654545-237.381818 41.890909-330.472727 134.981818-139.636364 144.290909-176.872727 353.745455-93.090909 525.963637l-18.618182 148.945454c0 13.963636 0 41.890909 18.618182 60.509091 18.618182 23.272727 41.890909 32.581818 69.818181 27.927273l144.29091-18.618182c55.854545 27.927273 125.672727 46.545455 200.145454 46.545454h13.963636c111.709091 0 223.418182-46.545455 311.854546-130.327272 88.436364-83.781818 139.636364-200.145455 139.636364-330.472728 9.309091-121.018182-41.890909-242.036364-130.327273-325.818181z m-325.818182 707.490909c-60.509091 0-125.672727-13.963636-176.872727-41.890909-9.309091-4.654545-13.963636-4.654545-18.618182-4.654546l-158.254546 23.272727 18.618182-158.254545c0-9.309091 0-18.618182-4.654545-23.272727-79.127273-144.290909-51.2-325.818182 69.818182-446.836364 74.472727-74.472727 172.218182-111.709091 274.618181-111.709091s200.145455 41.890909 274.618182 111.709091c74.472727 74.472727 111.709091 172.218182 111.709091 274.618182s-41.890909 200.145455-111.709091 274.618182c-79.127273 60.509091-176.872727 102.4-279.272727 102.4z" p-id="5294"></path><path d="M530.618182 707.490909c-18.618182-4.654545-32.581818-9.309091-46.545455 4.654546-13.963636 13.963636-13.963636 27.927273-9.309091 41.890909 0 4.654545 9.309091 9.309091 13.963637 13.963636l4.654545 4.654545 4.654546 4.654546c4.654545 0 13.963636 4.654545 18.618181 4.654545 9.309091 0 18.618182-4.654545 23.272728-9.309091 13.963636-13.963636 13.963636-32.581818 4.654545-41.890909l-13.963636-23.272727zM512 256c-134.981818 0-172.218182 102.4-172.218182 158.254545 0 18.618182 18.618182 37.236364 37.236364 37.236364s37.236364-18.618182 37.236363-37.236364c0-4.654545 0-83.781818 97.745455-83.781818 13.963636 0 60.509091 4.654545 79.127273 37.236364 18.618182 18.618182 18.618182 51.2 9.309091 69.818182-13.963636 13.963636-32.581818 32.581818-51.2 46.545454 0 0-4.654545 4.654545-9.309091 4.654546-4.654545 4.654545-9.309091 4.654545-9.309091 9.309091-37.236364 32.581818-60.509091 83.781818-60.509091 134.981818 0 9.309091 4.654545 18.618182 13.963636 27.927273 4.654545 4.654545 13.963636 13.963636 23.272728 13.963636 13.963636 0 18.618182-4.654545 23.272727-13.963636 4.654545-4.654545 9.309091-13.963636 9.309091-23.272728 0-27.927273 13.963636-60.509091 32.581818-79.127272 0 0 4.654545-4.654545 9.309091-4.654546 4.654545-4.654545 9.309091-4.654545 9.309091-9.309091l9.309091-9.309091c18.618182-13.963636 46.545455-32.581818 55.854545-60.509091 32.581818-51.2 23.272727-116.363636-13.963636-158.254545-23.272727-41.890909-69.818182-60.509091-130.327273-60.509091z"/>
					</svg>
				</div>
			</div>

			<div class="max-h-60 flex flex-col w-full rounded-r-xl bg-white">
				<div class="m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5">
					{#each selectUrlUserPrompt as item, itemIdx}
						<button
							class=" px-3 py-1.5 rounded-xl w-full text-left {itemIdx === selectedIdx
								? ' bg-gray-100 selected-command-option-button'
								: ''}"
							type="button"
							on:click={() => {
								confirmSelect(item);
							}}
							on:mousemove={() => {
								selectedIdx = itemIdx;
							}}
							on:focus={() => {}}
						>
							<div class=" font-medium text-black line-clamp-1">
								{item}
							</div>
						</button>
					{/each}
				</div>
			</div>
		</div>
	</div>
{/if}
